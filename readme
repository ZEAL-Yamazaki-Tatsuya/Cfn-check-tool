# AWS Infrastructure Inventory & Diff Tool

## 使用手順

### 1. AWS認証情報の設定
事前にsession tokenを取得して、取得結果を3つの環境変数にsetしておく

```powershell
# セッショントークンを取得
aws sts get-session-token --profile xxx --serial-number arn:aws:iam::xxxx:mfa/xxxx --token-code 123456

# 環境変数に設定
$env:AWS_ACCESS_KEY_ID='xxxx'
$env:AWS_SECRET_ACCESS_KEY='xxxx'
$env:AWS_SESSION_TOKEN='xxxx'
```

### 2. 変更前スナップショット取得
CloudFormation実行前に、下記コマンドを実行して実行前の各種情報を取得する

```powershell
.\InventorySnapshot.ps1 -OutDir .\snap -Label pre_20250922
```
- OutDir: 取得した情報の保存先ディレクトリ
- Label: OutDir配下にこのラベル名のディレクトリが作成され、その中に情報が保存される

### 3. 変更後スナップショット取得
CloudFormation実行後に、下記コマンドを実行して実行後の各種情報を取得する

```powershell
.\InventorySnapshot.ps1 -OutDir .\snap -Label post_20250922
```

### 4. 差分比較
取得した情報を比較する

```powershell
.\InventoryDiff.ps1 -BeforeDir .\snap\pre_20250922 -AfterDir .\snap\post_20250922 -OutReport .\snap\diff-report_20250922.txt
```
- BeforeDir: CloudFormation実行前に取得した情報が保存されているディレクトリ
- AfterDir: CloudFormation実行後に取得した情報が保存されているディレクトリ
- OutReport: 差分レポートの保存先ファイル名

## 機能
- 詳細な差分表示: どのフィールドがどのように変更されたかを具体的に表示
- 対応リソース: VPC, Subnet, Route Table, Security Group, Managed Prefix List等
- エラーハンドリング: 取得失敗時の適切なエラー処理